# JWT 인증 방식

## :book: 쿠키 & 세션 이란?

> Cookie

- 클라이언트가 웹사이트에 접속할 때 그 사이트가 사용하게 되는 일련의 작은 기록 파일이라고 생각하면 됩니다.
- 서버가 클라이언트에 정보를 전달할 때 저장하고자 하는 정보를 응답 헤더에 저장하여 전달합니다.
- Key Value 형식의 문자열 형태로 저장합니다.
- 브라우저에 저장되어서 사용하는 작은 텍스트 파일로써 접속자 장치를 인식하거나 일부데이터를 저장하는 역활을 합니다.

### 쿠키의 단점

- 쿠키는 노출이 되었을 때 id, pw에 대한 민감 정보까지 다 노출이 되어 보안이 좋지 않다.
- 조작당해서 들어올 가능성이 있다.
- 웹 브라우저마다 쿠키에 대한 지원 형태가 다르기 때문에 다른 브라우저간의 공유가 불가능하다.
- 쿠키의 사이즈가 제한(4KB)되어있어 원하는만큼의 충분한 데이터를 담을 수 없을 경우가 있다.
- 서버는 매번 id pw를 받아서 인증을 해야하는 불편함이 있으며 조작된 데이터가 넘어오는 경우를 방지할 수 없다.

> Session

- 무언가에 대한 특정 인증 정보를 서버가 가지고 있고 그 값을 클라이언트에게 전달하여 마치 키를 주고 자물쇠를 여는 방식으로 인증을 합니다.
- 세션 ID를 특정 저장소에 저장하여 사용합니다.
- 개인 민감정보를 그대로 노출했을 때의 단점을 막아내기 위해서 사용합니다.

- 세션을 사용하다가 보안에 문제가 되면, 세션 저장소를 전부 지워버리면 됩니다.

### 세션의 단점

- 세션 저장소의 문제가 발생하면 인증 체계가 무너져 이전에 다른 인증된 유저 또한 인증이 불가해진다.
- stateful하기 때문에 http의 장점을 발휘하지 못하고 scale out에 걸림돌이 생긴다.
- 세션 저장소가 필수적으로 존재하기 때문에 이를 사용하기위한 비용이 든다.
- 세션 ID가 탈취되었을 경우 대처는 가능하지만 클라이언트인척 위장하는 보안의 약점이 있을 수 있다.
- 사용자가 많아질수록 메모리를 많이 차지하게 된다.
- "매번" 요청 시 세션 저장소를 조회해야하는 단점이 있다.

---

## JWT 토큰

> JWT은 위와 같은 일련의 과정 속에서 나타난 하나의 인터넷 표준 인증 방식입니다.

- 인증에 필요한 정보들을 Token에 담아 암호와시켜 사용하는 토큰입니다.
- 기본적인 인증을 진행하는 구조는 크게 다르지 않지만 JWT는 서명된 토큰이라는 점입니다.

### JWT의 구조

- Header
- Payload
- Signature

### JWT의 장점

- 이미 토큰 자체가 인증된 정보이기 때문에 세션 저장소와 같은 별도의 인증 저장소가 "필수적"으로 필요하지 않습니다.
- 세션과는 다르게 클라이언트의 상태를 서버가 저장해두지 않아도 됩니다.
- signature를 공통키 개인키 암호화를 통해 막아두었기 때문에 데이터에 대한 보완성이 늘어납니다.
- 다른 서비스에 이용할 수 있는 공통적인 스펙으로써 사용할 수 있습니다.

### JWT의 단점

- 쿠키, 세션때와는 다르게 base64인코딩을 통한 정보를 전달하므로 전달량이 많다. 따라서 네트워크 전달 시 많은 데이터량으로 부하가 생길 수 있다.
- Payload에는 암호화가 되어있지 않기 때문에 민감 정보를 저장할 수 없다.
- 토큰이 탈취당하면 만료될 때까지 대처가 불가능하다.

### JWT의 보완

- JWT의 만료 시간을 짧게 가져갑니다. -> 짧은 시간만 유효하기 때문에 최소한의 보안성을 보장함
- 짧은 유효시간을 보완할 만한 두가지 방법
  - Sliding Session
  - Refresh Token

#### Sliding Session

> 특정한 서비스를 계속 사용하고 있는 특정 유저에 대해 만료 시간을 연장시켜주는 방법입니다.

- 특정 action을 유저가 행동하였을 때 새롭게 만료시간을 늘린 JWT를 다시 제공함으로써 만료시간을 연장하여 보완하는 방법입니다.

#### Refresh Token

> Access Token과 함께 Refresh Token이라는 토큰을 발급하여 짧은 만료시간을 해결하는 방법입니다.

- Refresh Token은 말 그대로 Access Token을 Refresh해주는 것을 보장하는 토큰입니다.

```
클라이언트가 ID, PW로 서버에게 인증을 요청하고 서버는 이를 확인하여 Access Token과 Refresh Token을 발급합니다.
클라이언트는 이를 받아 Refresh Token를 본인이 잘 저장하고 Access Token을 가지고 서버에 자유롭게 요청합니다.
요청을 하던 도중 Access Token이 만료되어 더이상 사용할 수 없다는 오류를 서버로부터 전달 받습니다.
클라이언트는 본인이 사용한 Access Token이 만료되었다는 사실을 인지하고 본인이 가지고 있던 Refresh Token를 서버로 전달하여 새로운 Access Token의 발급을 요청합니다.
서버는 Refresh Token을 받아 서버의 Refresh Token Storage에 해당 토큰이 있는지 확인하고, 있다면 Access Token을 생성하여 전달합니다.
이후 2로 돌아가서 동일한 작업을 진행합니다.
```

```
[참고 사이트](https://jinyoungchoi95.tistory.com/m/39)
```
